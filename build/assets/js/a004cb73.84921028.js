"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6480],{22220:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>l});var i=o(85893),r=o(11151);const t={tags:["Nodes"],description:"This tutorial demonstrates how to set up infrastructure to monitor an instance of Luxd.",sidebar_label:"Upgrade",pagination_label:"Upgrade Your Luxd Node",sidebar_position:3},d="Upgrade Your Luxd Node",s={id:"nodes/maintain/upgrade-your-luxd-node",title:"Upgrade Your Luxd Node",description:"This tutorial demonstrates how to set up infrastructure to monitor an instance of Luxd.",source:"@site/docs/nodes/maintain/upgrade-your-luxd-node.md",sourceDirName:"nodes/maintain",slug:"/nodes/maintain/upgrade-your-luxd-node",permalink:"/nodes/maintain/upgrade-your-luxd-node",draft:!1,unlisted:!1,editUrl:"https://github.com/luxdefi/docs/edit/main/docs/nodes/maintain/upgrade-your-luxd-node.md",tags:[{label:"Nodes",permalink:"/tags/nodes"}],version:"current",sidebarPosition:3,frontMatter:{tags:["Nodes"],description:"This tutorial demonstrates how to set up infrastructure to monitor an instance of Luxd.",sidebar_label:"Upgrade",pagination_label:"Upgrade Your Luxd Node",sidebar_position:3},sidebar:"nodes",previous:{title:"Monitor an Lux Node",permalink:"/nodes/maintain/setting-up-node-monitoring"},next:{title:"Reduce a Node's Disk Space: Run C-Chain Offline Pruning",permalink:"/nodes/maintain/run-offline-pruning"}},a={},l=[{value:"Backup Your Node",id:"backup-your-node",level:2},{value:"Node Installed Using the Installer Script",id:"node-installed-using-the-installer-script",level:2},{value:"Stop the Old Node Version",id:"stop-the-old-node-version",level:2},{value:"Node Running from Terminal",id:"node-running-from-terminal",level:3},{value:"Node Running as a Service",id:"node-running-as-a-service",level:3},{value:"Node Running in Background",id:"node-running-in-background",level:3},{value:"Download Pre-Built Binary",id:"download-pre-built-binary",level:2},{value:"Running the Node from Terminal",id:"running-the-node-from-terminal",level:3},{value:"Running the Node as a Service",id:"running-the-node-as-a-service",level:3},{value:"Build from Source",id:"build-from-source",level:2}];function c(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"upgrade-your-luxd-node",children:"Upgrade Your Luxd Node"}),"\n",(0,i.jsx)(n.h2,{id:"backup-your-node",children:"Backup Your Node"}),"\n",(0,i.jsx)(n.p,{children:"Before upgrading your node, it is recommended you backup your staker files which\nare used to identify your node on the network. In the default installation, you\ncan copy them by running following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"cd\ncp ~/.luxd/staking/staker.crt .\ncp ~/.luxd/staking/staker.key .\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then download ",(0,i.jsx)(n.code,{children:"staker.crt"})," and ",(0,i.jsx)(n.code,{children:"staker.key"})," files and keep them somewhere safe\nand private. If anything happens to your node or the machine node runs on, these\nfiles can be used to fully recreate your node."]}),"\n",(0,i.jsx)(n.p,{children:"If you use your node for development purposes and have keystore users on your\nnode, you should back up those too."}),"\n",(0,i.jsx)(n.h2,{id:"node-installed-using-the-installer-script",children:"Node Installed Using the Installer Script"}),"\n",(0,i.jsxs)(n.p,{children:["If you installed your node using the ",(0,i.jsx)(n.a,{href:"/nodes/run/with-installer/installing-luxd",children:"installer script"}),", to upgrade your\nnode, just run the installer script again."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"./luxd-installer.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"It will detect that you already have Luxd installed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Luxd installer\n---------------------\nPreparing environment...\nFound 64bit Intel/AMD architecture...\nFound Luxd systemd service already installed, switching to upgrade mode.\nStopping service...\n"})}),"\n",(0,i.jsx)(n.p,{children:"It will then upgrade your node to the latest version, and after it's done, start\nthe node back up, and print out the information about the latest version:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Node upgraded, starting service...\nNew node version:\nlux/1.1.1 [network=mainnet, database=v1.0.0, commit=f76f1fd5f99736cf468413bbac158d6626f712d2]\nDone!\n"})}),"\n",(0,i.jsx)(n.p,{children:"And that is it, your node is upgraded to the latest version."}),"\n",(0,i.jsx)(n.p,{children:"If you installed your node manually, proceed with the rest of the tutorial."}),"\n",(0,i.jsx)(n.h2,{id:"stop-the-old-node-version",children:"Stop the Old Node Version"}),"\n",(0,i.jsx)(n.p,{children:"After the backup is secured, you may start upgrading your node. Begin by\nstopping the currently running version."}),"\n",(0,i.jsx)(n.h3,{id:"node-running-from-terminal",children:"Node Running from Terminal"}),"\n",(0,i.jsxs)(n.p,{children:["If your node is running in a terminal stop it by pressing ",(0,i.jsx)(n.code,{children:"ctrl+c"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"node-running-as-a-service",children:"Node Running as a Service"}),"\n",(0,i.jsx)(n.p,{children:"If your node is running as a service, stop it by entering:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"sudo systemctl stop luxd.service"})}),"\n",(0,i.jsxs)(n.p,{children:["(your service may be named differently, ",(0,i.jsx)(n.code,{children:"lux.service"}),", or similar)"]}),"\n",(0,i.jsx)(n.h3,{id:"node-running-in-background",children:"Node Running in Background"}),"\n",(0,i.jsxs)(n.p,{children:["If your node is running in the background (by running with ",(0,i.jsx)(n.code,{children:"nohup"}),", for example)\nthen find the process running the node by running ",(0,i.jsx)(n.code,{children:"ps aux | grep lux"}),".\nThis will produce output like:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"ubuntu  6834  0.0  0.0   2828   676 pts/1    S+   19:54   0:00 grep lux\nubuntu  2630 26.1  9.4 2459236 753316 ?      Sl   Dec02 1220:52 /home/ubuntu/build/luxd\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, second line shows information about your node. Note the process\nid, in this case, ",(0,i.jsx)(n.code,{children:"2630"}),". Stop the node by running ",(0,i.jsx)(n.code,{children:"kill -2 2630"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Now we are ready to download the new version of the node. You can either\ndownload the source code and then build the binary program, or you can download\nthe pre-built binary. You don\u2019t need to do both."}),"\n",(0,i.jsx)(n.p,{children:"Downloading pre-built binary is easier and recommended if you're just looking to\nrun your own node and stake on it."}),"\n",(0,i.jsxs)(n.p,{children:["Building the node ",(0,i.jsx)(n.a,{href:"/nodes/maintain/upgrade-your-luxd-node#build-from-source",children:"from source"})," is recommended if\nyou're a developer looking to experiment and build on Lux."]}),"\n",(0,i.jsx)(n.h2,{id:"download-pre-built-binary",children:"Download Pre-Built Binary"}),"\n",(0,i.jsxs)(n.p,{children:["If you want to download a pre-built binary instead of building it yourself, go\nto our ",(0,i.jsx)(n.a,{href:"https://github.com/luxdefi/luxd/releases",children:"releases page"}),", and\nselect the release you want (probably the latest one.)"]}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["If you have a node, you can subscribe to the\n",(0,i.jsx)(n.a,{href:"/nodes/maintain/notify",children:"lux notify service"})," with your node ID\nto be notified about new releases."]}),(0,i.jsxs)(n.p,{children:["In addition, or if you don't have a node ID, you can get release notifications from github.\nTo do so, you can go to our\n",(0,i.jsx)(n.a,{href:"https://github.com/luxdefi/luxd",children:"repository"})," and look on the top-right\ncorner for the ",(0,i.jsx)(n.strong,{children:"Watch"})," option. After you click on it, select ",(0,i.jsx)(n.strong,{children:"Custom"}),",\nand then ",(0,i.jsx)(n.strong,{children:"Releases"}),". Press ",(0,i.jsx)(n.strong,{children:"Apply"})," and it is done."]})]}),"\n",(0,i.jsxs)(n.p,{children:["Under ",(0,i.jsx)(n.code,{children:"Assets"}),", select the appropriate file."]}),"\n",(0,i.jsxs)(n.p,{children:["For MacOS:",(0,i.jsx)(n.br,{}),"\n","Download: ",(0,i.jsx)(n.code,{children:"luxd-macos-<VERSION>.zip"}),(0,i.jsx)(n.br,{}),"\n","Unzip: ",(0,i.jsx)(n.code,{children:"unzip luxd-macos-<VERSION>.zip"}),(0,i.jsx)(n.br,{}),"\n","The resulting folder, ",(0,i.jsx)(n.code,{children:"luxd-<VERSION>"}),", contains the binaries."]}),"\n",(0,i.jsxs)(n.p,{children:["For Linux on PCs or cloud providers:",(0,i.jsx)(n.br,{}),"\n","Download: ",(0,i.jsx)(n.code,{children:"luxd-linux-amd64-<VERSION>.tar.gz"}),(0,i.jsx)(n.br,{}),"\n","Unzip: ",(0,i.jsx)(n.code,{children:"tar -xvf luxd-linux-amd64-<VERSION>.tar.gz"}),(0,i.jsx)(n.br,{}),"\n","The resulting folder, ",(0,i.jsx)(n.code,{children:"luxd-<VERSION>-linux"}),", contains the binaries."]}),"\n",(0,i.jsxs)(n.p,{children:["For Linux on Arm64-based computers:",(0,i.jsx)(n.br,{}),"\n","Download: ",(0,i.jsx)(n.code,{children:"luxd-linux-arm64-<VERSION>.tar.gz"}),(0,i.jsx)(n.br,{}),"\n","Unzip: ",(0,i.jsx)(n.code,{children:"tar -xvf luxd-linux-arm64-<VERSION>.tar.gz"}),(0,i.jsx)(n.br,{}),"\n","The resulting folder, ",(0,i.jsx)(n.code,{children:"luxd-<VERSION>-linux"}),", contains the binaries."]}),"\n",(0,i.jsx)(n.p,{children:"You are now ready to run the new version of the node."}),"\n",(0,i.jsx)(n.h3,{id:"running-the-node-from-terminal",children:"Running the Node from Terminal"}),"\n",(0,i.jsx)(n.p,{children:"If you are using the pre-built binaries on MacOS:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"./luxd-<VERSION>/build/luxd\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you are using the pre-built binaries on Linux:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"./luxd-<VERSION>-linux/luxd\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add ",(0,i.jsx)(n.code,{children:"nohup"})," at the start of the command if you want to run the node in the background."]}),"\n",(0,i.jsx)(n.h3,{id:"running-the-node-as-a-service",children:"Running the Node as a Service"}),"\n",(0,i.jsx)(n.p,{children:"If you're running the node as a service, you need to replace the old binaries with the new ones."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"cp -r luxd-<VERSION>-linux/* <DIRECTORY_WITH_OLD_BINARIES>"})}),"\n",(0,i.jsxs)(n.p,{children:["and then restart the service with ",(0,i.jsx)(n.code,{children:"sudo systemctl start luxd.service"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"build-from-source",children:"Build from Source"}),"\n",(0,i.jsx)(n.p,{children:"First clone our GitHub repo (you can skip this step if you\u2019ve done this before):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"git clone https://github.com/luxdefi/luxd.git\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"The repository cloning method used is HTTPS, but SSH can be used too:"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"git clone git@github.com:luxdefi/luxd.git"})}),(0,i.jsxs)(n.p,{children:["You can find more about SSH and how to use it\n",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/authentication/connecting-to-github-with-ssh/about-ssh",children:"here"}),"."]})]}),"\n",(0,i.jsx)(n.p,{children:"Then move to the Luxd directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"cd luxd\n"})}),"\n",(0,i.jsx)(n.p,{children:"Pull the latest code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"git pull\n"})}),"\n",(0,i.jsxs)(n.p,{children:["NOTE: if the master branch has not been updated with the latest release tag, you\ncan get to it directly via first running ",(0,i.jsx)(n.code,{children:"git fetch --all --tags"})," and then ",(0,i.jsx)(n.code,{children:"git checkout --force tags/<tag>"})," (where ",(0,i.jsx)(n.code,{children:"<tag>"})," is the latest release tag; for\nexample ",(0,i.jsx)(n.code,{children:"v1.3.2"}),") instead of ",(0,i.jsx)(n.code,{children:"git pull"}),". Note that your local copy will be in a\n'detached HEAD' state, which is not an issue if you do not make changes to the\nsource that you want push back to the repository (in which case you should check\nout to a branch and to the ordinary merges). Note also that the ",(0,i.jsx)(n.code,{children:"--force"})," flag\nwill disregard any local changes you might have."]}),"\n",(0,i.jsx)(n.p,{children:"Check that your local code is up to date. Do:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"git rev-parse HEAD\n"})}),"\n",(0,i.jsxs)(n.p,{children:["and check that the first 7 characters printed match the Latest commit field on our ",(0,i.jsx)(n.a,{href:"https://github.com/luxdefi/luxd",children:"GitHub"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["NOTE: if you used the ",(0,i.jsx)(n.code,{children:"git checkout tags/<tag>"})," then these first 7 characters\nshould match commit hash of that tag."]}),"\n",(0,i.jsx)(n.p,{children:"Now build the binary:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"./scripts/build.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"This should print:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"Build Successful\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can check what version you\u2019re running by doing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"./build/luxd --version\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can run your node with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-zsh",children:"./build/luxd\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},11151:(e,n,o)=>{o.d(n,{Z:()=>s,a:()=>d});var i=o(67294);const r={},t=i.createContext(r);function d(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);