"use strict";(self.webpackChunk_luxdocs_network=self.webpackChunk_luxdocs_network||[]).push([[1616],{16647:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var o=t(49214),a=t(43540);const i={tags:["Build","Subnets"],description:"This tutorial demonstrates how to deploy a Subnet to production environment.",sidebar_label:"On Production Infrastructure",pagination_label:"Deploy Subnets on Production Infrastructure",sidebar_position:3},s="Deploy Subnets on Production Infrastructure",r={id:"build/subnet/deploy/on-prod-infra",title:"Deploy Subnets on Production Infrastructure",description:"This tutorial demonstrates how to deploy a Subnet to production environment.",source:"@site/docs/build/subnet/deploy/on-prod-infra.md",sourceDirName:"build/subnet/deploy",slug:"/build/subnet/deploy/on-prod-infra",permalink:"/docs/build/subnet/deploy/on-prod-infra",draft:!1,unlisted:!1,editUrl:"https://github.com/luxfi/docs/edit/main/docs/build/subnet/deploy/on-prod-infra.md",tags:[{label:"Build",permalink:"/docs/tags/build"},{label:"Subnets",permalink:"/docs/tags/subnets"}],version:"current",sidebarPosition:3,frontMatter:{tags:["Build","Subnets"],description:"This tutorial demonstrates how to deploy a Subnet to production environment.",sidebar_label:"On Production Infrastructure",pagination_label:"Deploy Subnets on Production Infrastructure",sidebar_position:3},sidebar:"build-subnet",previous:{title:"Deploy a Permissioned Subnet on Mainnet",permalink:"/docs/build/subnet/deploy/mainnet-subnet"},next:{title:"Deploy a Subnet with Multisig Authorization",permalink:"/docs/build/subnet/deploy/multisig-auth"}},l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Node Setup",id:"node-setup",level:2},{value:"Server OS",id:"server-os",level:3},{value:"Hardware Specification",id:"hardware-specification",level:3},{value:"Server Location",id:"server-location",level:3},{value:"Local Servers",id:"local-servers",level:4},{value:"Cloud Providers",id:"cloud-providers",level:4},{value:"Number of Validators",id:"number-of-validators",level:3},{value:"Node Bootstrap",id:"node-bootstrap",level:3},{value:"State Sync",id:"state-sync",level:4},{value:"Database Copy",id:"database-copy",level:4},{value:"Subnet Deploy",id:"subnet-deploy",level:2},{value:"Ledger HW Wallet",id:"ledger-hw-wallet",level:3},{value:"Genesis File",id:"genesis-file",level:3},{value:"Validator Configuration",id:"validator-configuration",level:2},{value:"Joining a Subnet",id:"joining-a-subnet",level:3},{value:"Subnet Bootstrapping",id:"subnet-bootstrapping",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Managing Validation",id:"managing-validation",level:3},{value:"Conclusion",id:"conclusion",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"deploy-subnets-on-production-infrastructure",children:"Deploy Subnets on Production Infrastructure"}),"\n",(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsxs)(n.p,{children:["After architecting your Subnet environment on the ",(0,o.jsx)(n.a,{href:"/docs/build/subnet/deploy/local-subnet",children:"local machine"}),",\nproving\nthe design and testing it out on ",(0,o.jsx)(n.a,{href:"/docs/build/subnet/deploy/testnet-subnet",children:"the Testnet"}),",\neventually you will\nneed to deploy your Subnet to production environment. Running a Subnet in production is much more\ninvolved than local and Testnet deploys, as your Subnet will have to take care of real world usage,\nmaintaining uptime, upgrades and all of that in a potentially adversarial environment. The purpose\nof this document is to point out a set of general considerations and propose potential solutions to\nthem."]}),"\n",(0,o.jsx)(n.p,{children:"The architecture of the environment your particular Subnet will use will be greatly influenced by\nthe type of load and activity your Subnet is designed to support so your solution will most likely\ndiffer from what we propose here. Still, it might be useful to follow along, to build up the\nintuition for the type of questions you will need to consider."}),"\n",(0,o.jsx)(n.h2,{id:"node-setup",children:"Node Setup"}),"\n",(0,o.jsxs)(n.p,{children:["Lux nodes are essential elements for running your Subnet in production. At a minimum, your\nSubnet will need validator nodes, potentially also nodes that act as RPC servers, indexers or\nexplorers. Running a node is basically running an instance of ",(0,o.jsx)(n.a,{href:"/docs/nodes/",children:"Luxd"})," on a\nserver."]}),"\n",(0,o.jsx)(n.h3,{id:"server-os",children:"Server OS"}),"\n",(0,o.jsx)(n.p,{children:"Although Luxd can run on a MacOS or a Windows computer, we strongly recommend running nodes\non computers running Linux as they are designed specifically for server loads and all the tools and\nutilities needed for administering a server are native to Linux."}),"\n",(0,o.jsx)(n.h3,{id:"hardware-specification",children:"Hardware Specification"}),"\n",(0,o.jsx)(n.p,{children:"For running Luxd as a validator on the Primary Network the recommended configuration is as follows:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"CPU: Equivalent of 8 AWS vCPU"}),"\n",(0,o.jsx)(n.li,{children:"RAM: 16 GiB"}),"\n",(0,o.jsx)(n.li,{children:"Storage: 1 TiB with at least 3000 IOPS"}),"\n",(0,o.jsx)(n.li,{children:"OS: Ubuntu 20.04"}),"\n",(0,o.jsx)(n.li,{children:"Network: Reliable IPv4 or IPv6 network connection, with an open public port"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"That is the configuration sufficient for running a Primary Network node. Any resource requirements\nfor your Subnet come on top of this, so you should not go below this configuration, but may need to\nstep up the specification if you expect your Subnet to handle a significant amount of transactions."}),"\n",(0,o.jsx)(n.p,{children:"Be sure to set up monitoring of resource consumption for your nodes because resource exhaustion may\ncause your node to slow down or even halt, which may severely impact your Subnet negatively."}),"\n",(0,o.jsx)(n.h3,{id:"server-location",children:"Server Location"}),"\n",(0,o.jsx)(n.p,{children:"You can run a node on a physical computer that you own and run, or on a cloud instance. Although\nrunning on your own HW may seem like a good idea, unless you have a sizeable DevOps 24/7 staff we\nrecommend using cloud service providers as they generally provide reliable computing resources that\nyou can count on to be properly maintained and monitored."}),"\n",(0,o.jsx)(n.h4,{id:"local-servers",children:"Local Servers"}),"\n",(0,o.jsx)(n.p,{children:"If you plan on running nodes on your own hardware, make sure they satisfy the minimum HW\nspecification as outlined earlier. Pay close attention to proper networking setup, making sure the\np2p port (9651) is accessible and public IP properly configured on the node. Make sure the node is\nconnected to the network physically (not over Wi-Fi), and that the router is powerful enough to\nhandle a couple of thousands of persistent TCP connections and that network bandwidth can\naccommodate at least 5Mbps of steady upstream and downstream network traffic."}),"\n",(0,o.jsxs)(n.p,{children:["When installing the Luxd node on the machines, unless you have a dedicated DevOps staff that\nwill take care of node setup and configuration, we recommend using the\n",(0,o.jsx)(n.a,{href:"/docs/nodes/run/with-installer/installing-luxd",children:"installer script"})," to set up the nodes.\nIt will abstract most of the setup process for you, set up the node as a system\nservice and will enable easy node upgrades."]}),"\n",(0,o.jsx)(n.h4,{id:"cloud-providers",children:"Cloud Providers"}),"\n",(0,o.jsx)(n.p,{children:"There are a number of different cloud providers. We have documents that show how to set up a node on\nthe most popular ones:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/nodes/run/third-party/aws-node",children:"Amazon Web Services"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/nodes/run/third-party/microsoft-azure-node",children:"Azure"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/nodes/run/third-party/google-cloud-node",children:"Google Cloud Platform"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"There is a whole range of other cloud providers that may offer lower prices or better deals for your\nparticular needs, so it makes sense to shop around."}),"\n",(0,o.jsx)(n.p,{children:"Once you decide on a provider (or providers), if they offer instances in multiple data centers, it\nmakes sense to spread the nodes geographically since that provides a better resilience and stability\nagainst outages."}),"\n",(0,o.jsx)(n.h3,{id:"number-of-validators",children:"Number of Validators"}),"\n",(0,o.jsx)(n.p,{children:"Number of validators on a Subnet is a crucial decision you need to make. For stability and\ndecentralization, you should strive to have as many validators as possible."}),"\n",(0,o.jsxs)(n.p,{children:["For stability reasons our recommendation is to have ",(0,o.jsx)(n.strong,{children:"at least"})," 5 full validators on your Subnet.\nIf you have less than 5 validators your Subnet liveness will be at risk whenever a single validator\ngoes offline, and if you have less than 4 even one offline node will halt your Subnet."]}),"\n",(0,o.jsx)(n.p,{children:"You should be aware that 5 is the minimum we recommend. But, from a decentralization standpoint\nhaving more validators is always better as it increases the stability of your Subnet and makes it\nmore resilient to both technical failures and adversarial action. In a nutshell: run as many Subnet\nvalidators as you can."}),"\n",(0,o.jsx)(n.p,{children:"Considering that at times you will have to take nodes offline, for routine maintenance (at least for\nnode upgrades which happen with some regularity) or unscheduled outages and failures you need to be\nable to routinely handle at least one node being offline without your Subnet performance degrading."}),"\n",(0,o.jsx)(n.h3,{id:"node-bootstrap",children:"Node Bootstrap"}),"\n",(0,o.jsx)(n.p,{children:"Once you set up the server and install Luxd on them, nodes will need to bootstrap (sync with\nthe network). This is a lengthy process, as the nodes need to catch up and replay all the network\nactivity since the genesis up to the present moment. Full bootstrap on a node can take more than a\nweek, but there are ways to shorten that process, depending on your circumstances."}),"\n",(0,o.jsx)(n.h4,{id:"state-sync",children:"State Sync"}),"\n",(0,o.jsxs)(n.p,{children:["If the nodes you will be running as validators don't need to have the full transaction history, then\nyou can use ",(0,o.jsx)(n.a,{href:"/docs/nodes/configure/chain-config-flags#state-sync-enabled-boolean",children:"state sync"}),". With\nthis flag enabled, instead of replaying the whole history to get to the current state, nodes simply\ndownload only the current state from other network peers, shortening the bootstrap process from\nmultiple days to a couple of hours. If the nodes will be used for Subnet validation exclusively, you\ncan use the state sync without any issues. Currently, state sync is only available for the C-Chain,\nbut since the bulk of the transactions on the platform happen there it still has a significant\nimpact on the speed of bootstrapping."]}),"\n",(0,o.jsx)(n.h4,{id:"database-copy",children:"Database Copy"}),"\n",(0,o.jsxs)(n.p,{children:["Good way to cut down on bootstrap times on multiple nodes is database copy. Database is identical\nacross nodes, and as such can safely be copied from one node to another. Just make sure to that the\nnode is not running during the copy process, as that can result in a corrupted database. Database\ncopy procedure is explained in detail ",(0,o.jsx)(n.a,{href:"/docs/nodes/maintain/node-backup-and-restore#database",children:"here"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Please make sure you don't reuse any node's NodeID by accident, especially don't restore another\nnode's ID, see ",(0,o.jsx)(n.a,{href:"/docs/nodes/maintain/node-backup-and-restore#nodeid",children:"here"})," for details. Each node\nmust has its own unique NodeID, otherwise, the nodes sharing the same ID will not behave correctly,\nwhich will impact your validator's uptime, thus staking rewards, and the stability of your Subnet."]}),"\n",(0,o.jsx)(n.h2,{id:"subnet-deploy",children:"Subnet Deploy"}),"\n",(0,o.jsxs)(n.p,{children:["Once you have the nodes set up you are ready to deploy the actual Subnet. Right now, the recommended\ntool to do that is ",(0,o.jsx)(n.a,{href:"https://github.com/luxfi/cli",children:"Lux-CLI"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Instructions for deployment by Lux-CLI can be found ",(0,o.jsx)(n.a,{href:"/docs/build/subnet/deploy/mainnet-subnet",children:"here"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"ledger-hw-wallet",children:"Ledger HW Wallet"}),"\n",(0,o.jsxs)(n.p,{children:["When creating the Subnet, you will be required to have a private key that will control the\nadministrative functions of the Subnet (adding validators, managing the configuration). Needless to\nsay, whoever has this private key has complete control over the Subnet and the way it runs.\nTherefore, protecting that key is of the utmost operational importance. Which is why we strongly\nrecommend using a hardware wallet such as a ",(0,o.jsx)(n.a,{href:"https://www.ledger.com/",children:"Ledger HW Wallet"})," to store and\naccess that private key."]}),"\n",(0,o.jsxs)(n.p,{children:["General instruction on how to use a Ledger\ndevice with Lux can be found\n",(0,o.jsx)(n.a,{href:"https://support.lux.network/en/articles/6150237-how-to-use-a-ledger-nano-s-or-nano-x-with-lux",children:"here"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"genesis-file",children:"Genesis File"}),"\n",(0,o.jsxs)(n.p,{children:["The structure that defines the most important parameters in a Subnet is found in the genesis file,\nwhich is a ",(0,o.jsx)(n.code,{children:"json"})," formatted, human-readable file. Describing the contents and the options available\nin the genesis file is beyond the scope of this document, and if you're ready to deploy your Subnet\nto production you probably have it mapped out already."]}),"\n",(0,o.jsxs)(n.p,{children:["If you want to review, we have a description of the genesis file in our document on\n",(0,o.jsx)(n.a,{href:"/docs/build/subnet/upgrade/customize-a-subnet",children:"customizing EVM Subnets"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"validator-configuration",children:"Validator Configuration"}),"\n",(0,o.jsx)(n.p,{children:"Running nodes as Subnet validators warrants some additional considerations, above those when running\na regular node or a Primary Network-only validator."}),"\n",(0,o.jsx)(n.h3,{id:"joining-a-subnet",children:"Joining a Subnet"}),"\n",(0,o.jsx)(n.p,{children:"For a node to join a Subnet, there are two prerequisites:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Primary Network validation"}),"\n",(0,o.jsx)(n.li,{children:"Subnet tracking"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Primary Network validation means that a node cannot join a Subnet as a validator before becoming a\nvalidator on the Primary Network itself. So, after you add the node to the validator set on the\nPrimary Network, node can join a Subnet. Of course, this is valid only for Subnet validators, if you\nneed a non-validating Subnet node, then the node doesn't need to be a validator at all."}),"\n",(0,o.jsxs)(n.p,{children:["To have a node start syncing the Subnet, you need to add the ",(0,o.jsx)(n.code,{children:"--track-subnets"})," command line\noption, or ",(0,o.jsx)(n.code,{children:"track-subnets"})," key to the node config file (found at\n",(0,o.jsx)(n.code,{children:".luxd/configs/node.json"})," for installer-script created nodes). A single node can sync\nmultiple Subnets, so you can add them as a comma-separated list of Subnet IDs."]}),"\n",(0,o.jsx)(n.p,{children:"An example of a node config syncing two Subnets:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "public-ip-resolution-service": "opendns",\n  "http-host": "",\n  "track-subnets": "28nrH5T2BMvNrWecFcV3mfccjs6axM1TVyqe79MCv2Mhs8kxiY,Ai42MkKqk8yjXFCpoHXw7rdTWSHiKEMqh5h8gbxwjgkCUfkrk"\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["But that is not all. Besides tracking the SubnetID, the node also needs to have the\nplugin that contains the VM instance the blockchain in the Subnet will run. You should have already\nbeen through that on Testnet and Testnet, but for a refresher, you can refer to ",(0,o.jsx)(n.a,{href:"/docs/build/subnet/deploy/testnet-subnet",children:"this tutorial"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["So, name the VM plugin binary as the ",(0,o.jsx)(n.code,{children:"VMID"})," of the Subnet chain and place it in the ",(0,o.jsx)(n.code,{children:"plugins"}),"\ndirectory where the node binary is (for installer-script created nodes that would be\n",(0,o.jsx)(n.code,{children:"~/node/plugins/"}),")."]}),"\n",(0,o.jsx)(n.h3,{id:"subnet-bootstrapping",children:"Subnet Bootstrapping"}),"\n",(0,o.jsx)(n.p,{children:"After you have tracked the Subnet and placed the VM binary in the correct directory, your node is\nready to start syncing with the Subnet. Restart the node and monitor the log output. You should\nnotice something similar to:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"Jul 30 18:26:31 node-testnet luxd[1728308]: [07-30|18:26:31.422] INFO chains/manager.go:262 creating chain:\nJul 30 18:26:31 node-testnet luxd[1728308]:     ID: 2ebCneCbwthjQ1rYT41nhd7M76Hc6YmosMAQrTFhBq8qeqh6tt\nJul 30 18:26:31 node-testnet luxd[1728308]:     VMID:srEXiWaHuhNyGwPUi444Tu47ZEDwxTWrbQiuD7FmgSAQ6X7Dy\n"})}),"\n",(0,o.jsx)(n.p,{children:"That means the node has detected the Subnet, and is attempting to initialize it and start\nbootstrapping the Subnet. It might take some time (if there are already transactions on the Subnet),\nand eventually it will finish the bootstrap with a message like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"Jul 30 18:27:21 node-testnet luxd[1728308]: [07-30|18:27:21.055] INFO <2ebCneCbwthjQ1rYT41nhd7M76Hc6YmosMAQrTFhBq8qeqh6tt Chain> snowman/transitive.go:333 consensus starting with J5wjmotMCrM2DKxeBTBPfwgCPpvsjtuqWNozLog2TomTjSuGK as the last accepted block\n"})}),"\n",(0,o.jsx)(n.p,{children:"That means the node has successfully bootstrapped the Subnet and is now in sync. If the node is one\nof the validators, it will start validating any transactions that get posted to the Subnet."}),"\n",(0,o.jsx)(n.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,o.jsxs)(n.p,{children:["If you want to inspect the process of Subnet syncing, you can use the RPC call to check for the\n",(0,o.jsx)(n.a,{href:"/docs/reference/luxd/p-chain/api#platformgetblockchainstatus",children:"blockchain status"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["For a more in-depth look into Subnet operation, check out the blockchain log. By default, the log\ncan be found in ",(0,o.jsx)(n.code,{children:"~/.luxd/logs/ChainID.log"})," where you replace the ",(0,o.jsx)(n.code,{children:"ChainID"})," with the actual ID\nof the blockchain in your Subnet."]}),"\n",(0,o.jsxs)(n.p,{children:["For an even more thorough (and pretty!) insight into how the node and the Subnet is behaving, you\ncan install the Prometheus+Grafana monitoring system with the custom dashboards for the regular node\noperation, as well as a dedicated dashboard for Subnet data. Check out the\n",(0,o.jsx)(n.a,{href:"/docs/nodes/maintain/setting-up-node-monitoring",children:"tutorial"})," for information on how to set it up."]}),"\n",(0,o.jsx)(n.h3,{id:"managing-validation",children:"Managing Validation"}),"\n",(0,o.jsx)(n.p,{children:"On Lux all validations are limited in time and can range from two weeks up to one year.\nFurthermore, Subnet validations are always a subset of the Primary Network validation period (must\nbe shorter or the same). That means that periodically your validators will expire and you will need\nto submit a new validation transaction for both the Primary Network and your Subnet."}),"\n",(0,o.jsx)(n.p,{children:"Unless managed properly and in a timely manner, that can be disruptive for your Subnet (if all\nvalidators expire at the same time your Subnet will halt). To avoid that, keep notes on when a\nparticular validation is set to expire and be ready to renew it as soon as possible. Also, when\ninitially setting up the nodes, make sure to stagger the validator expiry so they don't all expire\non the same date. Setting end dates at least a day apart is a good practice, as well as setting\nreminders for each expiry."}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"Hopefully, by reading this document you have a better picture of the requirements and considerations\nyou need to make when deploying your Subnet to production and you are now better prepared to launch\nyour Subnet successfully."}),"\n",(0,o.jsx)(n.p,{children:"Keep in mind, running a Subnet in production is not a one-and-done kind of situation, it is in fact\nrunning a fleet of servers 24/7. And as with any real time service, you should have a robust\nlogging, monitoring and alerting systems to constantly check the nodes and Subnet health and alert\nyou if anything out of the ordinary happens."}),"\n",(0,o.jsxs)(n.p,{children:["If you have any questions, doubts or would like to chat, please check out our ",(0,o.jsx)(n.a,{href:"https://chat.lux.network/",children:"Discord\nserver"}),", where we host a dedicated ",(0,o.jsx)(n.code,{children:"#subnet-chat"})," channel dedicated to\ntalking about all things Subnet."]}),"\n",(0,o.jsx)(n.p,{children:"We hope to see you there!"})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},43540:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var o=t(48318);const a={},i=o.createContext(a);function s(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);