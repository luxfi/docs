"use strict";(self.webpackChunk_luxdocs_network=self.webpackChunk_luxdocs_network||[]).push([[3472],{86997:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var o=t(49214),i=t(43540);const r={tags:["Nodes"],description:"Launch a Lux Node on Google Cloud Platform.",sidebar_label:"Google Cloud",pagination_label:"Run a Lux Node with Google Cloud Platform",sidebar_position:3},s="Run a Lux Node with Google Cloud Platform",l={id:"nodes/run/third-party/google-cloud-node",title:"Run a Lux Node with Google Cloud Platform",description:"Launch a Lux Node on Google Cloud Platform.",source:"@site/docs/nodes/run/third-party/google-cloud-node.md",sourceDirName:"nodes/run/third-party",slug:"/nodes/run/third-party/google-cloud-node",permalink:"/docs/nodes/run/third-party/google-cloud-node",draft:!1,unlisted:!1,editUrl:"https://github.com/luxfi/docs/edit/main/docs/nodes/run/third-party/google-cloud-node.md",tags:[{label:"Nodes",permalink:"/docs/tags/nodes"}],version:"current",sidebarPosition:3,frontMatter:{tags:["Nodes"],description:"Launch a Lux Node on Google Cloud Platform.",sidebar_label:"Google Cloud",pagination_label:"Run a Lux Node with Google Cloud Platform",sidebar_position:3},sidebar:"nodes",previous:{title:"Run a Lux Node with Microsoft Azure",permalink:"/docs/nodes/run/third-party/microsoft-azure-node"},next:{title:"Common Errors While Building a Node",permalink:"/docs/nodes/run/FAQ"}},a={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Conventions",id:"conventions",level:2},{value:"Important Notes",id:"important-notes",level:2},{value:"Architectural Description",id:"architectural-description",level:2},{value:"Project",id:"project",level:3},{value:"Service Enablement",id:"service-enablement",level:4},{value:"Networking",id:"networking",level:3},{value:"Compute Network",id:"compute-network",level:4},{value:"Public IP",id:"public-ip",level:4},{value:"Subnets",id:"subnets",level:4},{value:"Compute",id:"compute",level:3},{value:"Disk",id:"disk",level:4},{value:"Instance",id:"instance",level:4},{value:"Zone",id:"zone",level:4},{value:"Firewall",id:"firewall",level:4},{value:"<a></a> Setup Instructions",id:"-setup-instructions",level:2},{value:"GCP Account",id:"gcp-account",level:3},{value:"Project",id:"project-1",level:3},{value:"Terraform State",id:"terraform-state",level:3},{value:"Clone GitHub Repository",id:"clone-github-repository",level:3},{value:"Terraform Configuration",id:"terraform-configuration",level:3},{value:"Terraform Execution",id:"terraform-execution",level:3},{value:"Plan",id:"plan",level:4},{value:"Apply",id:"apply",level:4},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"run-a-lux-node-with-google-cloud-platform",children:"Run a Lux Node with Google Cloud Platform"}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsx)(n.p,{children:"This document was written by a community member, some information may be outdated."})}),"\n",(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsxs)(n.p,{children:["Google's Cloud Platform (GCP) is a scalable, trusted and reliable hosting\nplatform. Google operates a significant amount of it's own global networking\ninfrastructure. It's ",(0,o.jsx)(n.a,{href:"https://cloud.google.com/blog/products/networking/google-cloud-networking-in-depth-cloud-cdn",children:"fiber\nnetwork"}),"\ncan provide highly stable and consistent global connectivity.\nIn this article, we will leverage GCP to deploy a node on which Lux can\ninstalled via ",(0,o.jsx)(n.a,{href:"https://www.terraform.io/",children:"terraform"}),". Leveraging ",(0,o.jsx)(n.code,{children:"terraform"})," may\nseem like overkill, it should set you apart as an operator\nand administrator as it will enable you greater flexibility and provide the\nbasis on which you can easily build further automation."]}),"\n",(0,o.jsx)(n.h2,{id:"conventions",children:"Conventions"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Items"})," highlighted in this manor are GCP parlance and can be searched for\nfurther reference in the Google documentation for their cloud products."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The machine type used in this documentation is for reference only and the\nactual sizing you use will depend entirely upon the amount that is staked and\ndelegated to the node."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"architectural-description",children:"Architectural Description"}),"\n",(0,o.jsxs)(n.p,{children:["This section aims to describe the architecture of the system that the steps in\nthe ",(0,o.jsx)(n.a,{href:"#setup-instructions",children:"Setup Instructions"})," section deploy when enacted. This\nis done so that the executor can not only deploy the reference architecture, but\nalso understand and potentially optimize it for their needs."]}),"\n",(0,o.jsx)(n.h3,{id:"project",children:"Project"}),"\n",(0,o.jsxs)(n.p,{children:["We will create and utilize a single GCP ",(0,o.jsx)(n.code,{children:"Project"})," for deployment of all resources."]}),"\n",(0,o.jsx)(n.h4,{id:"service-enablement",children:"Service Enablement"}),"\n",(0,o.jsx)(n.p,{children:"Within our GCP project we will need to enable the following Cloud Services:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Compute Engine"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"IAP"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"networking",children:"Networking"}),"\n",(0,o.jsx)(n.h4,{id:"compute-network",children:"Compute Network"}),"\n",(0,o.jsxs)(n.p,{children:["We will deploy a single ",(0,o.jsx)(n.code,{children:"Compute Network"})," object. This unit is where we will\ndeploy all subsequent networking objects. It provides a logical boundary and\nsecuritization context should you wish to deploy other chain stacks or other\ninfrastructure in GCP."]}),"\n",(0,o.jsx)(n.h4,{id:"public-ip",children:"Public IP"}),"\n",(0,o.jsxs)(n.p,{children:["Lux requires that a validator communicate outbound on the same public IP\naddress that it advertises for other peers to connect to it on. Within GCP this\nprecludes the possibility of us using a Cloud NAT Router for the outbound\ncommunications and requires us to bind the public IP that we provision to the\ninterface of the machine. We will provision a single ",(0,o.jsx)(n.code,{children:"EXTERNAL"})," static IPv4\n",(0,o.jsx)(n.code,{children:"Compute Address"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"subnets",children:"Subnets"}),"\n",(0,o.jsxs)(n.p,{children:["For the purposes of this documentation we will deploy a single ",(0,o.jsx)(n.code,{children:"Compute Subnetwork"})," in the US-EAST1 ",(0,o.jsx)(n.code,{children:"Region"})," with a /24 address range giving us 254 IP\naddresses (not all usable but for the sake of generalized documentation)."]}),"\n",(0,o.jsx)(n.h3,{id:"compute",children:"Compute"}),"\n",(0,o.jsx)(n.h4,{id:"disk",children:"Disk"}),"\n",(0,o.jsxs)(n.p,{children:["We will provision a single 400GB ",(0,o.jsx)(n.code,{children:"PD-SSD"})," disk that will be attached to our VM."]}),"\n",(0,o.jsx)(n.h4,{id:"instance",children:"Instance"}),"\n",(0,o.jsxs)(n.p,{children:["We will deploy a single ",(0,o.jsx)(n.code,{children:"Compute Instance"})," of size ",(0,o.jsx)(n.code,{children:"e2-standard-8"}),". Observations\nof operations using this machine specification suggest it is memory over\nprovisioned and could be brought down to 16GB using custom machine\nspecification; but please review and adjust as needed (the beauty of compute\nvirtualization!!)."]}),"\n",(0,o.jsx)(n.h4,{id:"zone",children:"Zone"}),"\n",(0,o.jsxs)(n.p,{children:["We will deploy our instance into the ",(0,o.jsx)(n.code,{children:"US-EAST1-B"})," ",(0,o.jsx)(n.code,{children:"Zone"})]}),"\n",(0,o.jsx)(n.h4,{id:"firewall",children:"Firewall"}),"\n",(0,o.jsxs)(n.p,{children:["We will provision the following ",(0,o.jsx)(n.code,{children:"Compute Firewall"})," rules:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"IAP INGRESS for SSH (TCP 22) - this only allows GCP IAP sources inbound on SSH."}),"\n",(0,o.jsx)(n.li,{children:"P2P INGRESS for LUX Peers (TCP 9651)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"These are obviously just default ports and can be tailored to your needs as you desire."}),"\n",(0,o.jsxs)(n.h2,{id:"-setup-instructions",children:[(0,o.jsx)("a",{name:"setup-instructions"})," Setup Instructions"]}),"\n",(0,o.jsx)(n.h3,{id:"gcp-account",children:"GCP Account"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["If you don't already have a GCP account go create one ",(0,o.jsx)(n.a,{href:"https://console.cloud.google.com/freetrial",children:"here"})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You will get some free bucks to run a trial, the trial is feature complete but\nyour usage will start to deplete your free bucks so turn off anything you don't\nneed and/or add a credit card to your account if you intend to run things long\nterm to avoid service shutdowns."}),"\n",(0,o.jsx)(n.h3,{id:"project-1",children:"Project"}),"\n",(0,o.jsxs)(n.p,{children:["Login to the GCP ",(0,o.jsx)(n.code,{children:"Cloud Console"})," and create a new ",(0,o.jsx)(n.code,{children:"Project"})," in your\norganization. Let's use the name ",(0,o.jsx)(n.code,{children:"my-lux-nodes"})," for the sake of this setup."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.img,{alt:"Select Project Dropdown",src:t(37329).A+"",width:"833",height:"182"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.img,{alt:"Click New Project Button",src:t(18975).A+"",width:"788",height:"237"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.img,{alt:"Create New Project",src:t(95733).A+"",width:"604",height:"480"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"terraform-state",children:"Terraform State"}),"\n",(0,o.jsx)(n.p,{children:"Terraform uses a state files to compose a differential between current\ninfrastructure configuration and the proposed plan. You can store this state in\na variety of different places, but using GCP storage is a reasonable approach\ngiven where we are deploying so we will stick with that."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.img,{alt:"Select Cloud Storage Browser",src:t(29138).A+"",width:"525",height:"287"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.img,{alt:"Create New Bucket",src:t(81711).A+"",width:"679",height:"158"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Authentication to GCP from terraform has a few different options which are laid\nout ",(0,o.jsx)(n.a,{href:"https://www.terraform.io/language/settings/backends/gcs",children:"here"}),". Please\nchose the option that aligns with your context and ensure those steps are\ncompleted before continuing."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Depending upon how you intend to execute your terraform operations you may or\nmay not need to enable public access to the bucket. Obviously, not exposing the\nbucket for ",(0,o.jsx)(n.code,{children:"public"})," access (even if authenticated) is preferable. If you intend\nto simply run terraform commands from your local machine then you will need to\nopen the access up. I recommend to employ a full CI/CD pipeline using GCP Cloud\nBuild which if utilized will mean the bucket can be marked as ",(0,o.jsx)(n.code,{children:"private"}),". A full\nwalk through of Cloud Build setup in this context can be found\n",(0,o.jsx)(n.a,{href:"https://cloud.google.com/architecture/managing-infrastructure-as-code",children:"here"})]})}),"\n",(0,o.jsx)(n.h3,{id:"clone-github-repository",children:"Clone GitHub Repository"}),"\n",(0,o.jsxs)(n.p,{children:["I have provided a rudimentary terraform construct to provision a node on which\nto run Lux which can be found\n",(0,o.jsx)(n.a,{href:"https://github.com/luxfi/docs/tree/master/static/scripts/terraform-gcp/projects/my-lux-project",children:"here"}),".\nDocumentation below assumes you are using this repository but if you have\nanother terraform skeleton similar steps will apply."]}),"\n",(0,o.jsx)(n.h3,{id:"terraform-configuration",children:"Terraform Configuration"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["If running terraform locally, please\n",(0,o.jsx)(n.a,{href:"https://learn.hashicorp.com/tutorials/terraform/install-cli",children:"install"})," it."]}),"\n",(0,o.jsxs)(n.li,{children:["In this repository, navigate to the ",(0,o.jsx)(n.code,{children:"terraform"})," directory."]}),"\n",(0,o.jsxs)(n.li,{children:["Under the ",(0,o.jsx)(n.code,{children:"projects"})," directory, rename the ",(0,o.jsx)(n.code,{children:"my-lux-project"})," directory to\nmatch your GCP project name that you created (not required, but nice to be\nconsistent)"]}),"\n",(0,o.jsxs)(n.li,{children:["Under the folder you just renamed locate the ",(0,o.jsx)(n.code,{children:"terraform.tfvars"})," file."]}),"\n",(0,o.jsx)(n.li,{children:"Edit this file and populate it with the values which make sense for your\ncontext and save it."}),"\n",(0,o.jsxs)(n.li,{children:["Locate the ",(0,o.jsx)(n.code,{children:"backend.tf"})," file in the same directory."]}),"\n",(0,o.jsxs)(n.li,{children:["Edit this file ensuring to replace the ",(0,o.jsx)(n.code,{children:"bucket"})," property with the GCS bucket\nname that you created earlier."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If you do not with to use cloud storage to persist terraform state then simply\nswitch the ",(0,o.jsx)(n.code,{children:"backend"})," to some other desirable provider."]}),"\n",(0,o.jsx)(n.h3,{id:"terraform-execution",children:"Terraform Execution"}),"\n",(0,o.jsxs)(n.p,{children:["Terraform enables us to see what it would do if we were to run it without\nactually applying any changes... this is called a ",(0,o.jsx)(n.code,{children:"plan"})," operation. This plan is\nthen enacted (optionally) by an ",(0,o.jsx)(n.code,{children:"apply"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"plan",children:"Plan"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["In a terminal which is able to execute the ",(0,o.jsx)(n.code,{children:"tf"})," binary, ",(0,o.jsx)(n.code,{children:"cd"})," to the\n~",(0,o.jsx)(n.code,{children:"my-lux-project"})," directory that you renamed in step 3 of ",(0,o.jsx)(n.code,{children:"Terraform Configuration"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Execute the command ",(0,o.jsx)(n.code,{children:"tf plan"})]}),"\n",(0,o.jsx)(n.li,{children:"You should see a JSON output to the stdout of the terminal which lays out the\noperations that terraform will execute to apply the intended state."}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"apply",children:"Apply"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["In a terminal which is able to execute the ",(0,o.jsx)(n.code,{children:"tf"})," binary, ",(0,o.jsx)(n.code,{children:"cd"})," to the\n~",(0,o.jsx)(n.code,{children:"my-lux-project"})," directory that you renamed in step 3 of ",(0,o.jsx)(n.code,{children:"Terraform Configuration"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Execute the command ",(0,o.jsx)(n.code,{children:"tf apply"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["If you want to ensure that terraform does ",(0,o.jsx)(n.strong,{children:"exactly"})," what you saw in the\n",(0,o.jsx)(n.code,{children:"apply"})," output, you can optionally request for the ",(0,o.jsx)(n.code,{children:"plan"})," output to be saved\nto a file to feed to ",(0,o.jsx)(n.code,{children:"apply"}),". This is generally considered best practice in\nhighly fluid environments where rapid change is occurring from multiple sources."]}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"Establishing CI/CD practices using tools such as GitHub and Terraform to manage\nyour infrastructure assets is a great way to ensure base disaster recovery\ncapabilities and to ensure you have a place to embed any ~tweaks you have to\nmake operationally removing the potential to miss them when you have to scale\nfrom 1 node to 10. Having an automated pipeline also gives you a place to build\na bigger house... what starts as your interest in building and managing a single\nLUX node today can quickly change into you building an infrastructure operation\nfor many different chains working with multiple different team members. I hope\nthis may have inspired you to take a leap into automation in this context!"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},95733:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/cloud_console_create_new_project-bdd69eb0a2efa6b5c5278ad826a338a8.png"},18975:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/cloud_console_new_project_button-e015158a5a636496099b6a0d921d7de2.png"},37329:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/cloud_console_project_dropdown-8bfff56a717f36ae5c6676a1f8090975.png"},29138:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/cloud_storage_browser-6b8377d8b35ee73f84a73ad1d66c30f5.png"},81711:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/cloud_storage_create_bucket-467caf63bb82f2453fbc66e6c5fbac1c.png"},43540:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var o=t(48318);const i={},r=o.createContext(i);function s(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);